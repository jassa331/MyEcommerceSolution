@page "/reset-password"
@inject HttpClient Http

<h3>Reset Password</h3>

<div class="reset-container">
    <input type="email" placeholder="Enter your email" @bind="email" required />
    <input type="text" placeholder="Enter your reset token" @bind="token" required />
    <input type="password" placeholder="Enter new password" @bind="newPassword" required />

    <button @onclick="ResetPasswordAsync">Reset Password</button>

    @if (!string.IsNullOrEmpty(message))
    {
        <p>@message</p>
    }
</div>

@code {
    private string email = "";
    private string token = "";
    private string newPassword = "";
    private string message = "";

    private async Task ResetPasswordAsync()
    {
        message = "";

        if (string.IsNullOrWhiteSpace(email) ||
            string.IsNullOrWhiteSpace(token) ||
            string.IsNullOrWhiteSpace(newPassword))
        {
            message = "⚠️ Please fill all fields.";
            return;
        }

        try
        {
            // Send query parameters to the API
            var response = await Http.PostAsJsonAsync(
                $"https://localhost:7124/api/Account/reset-password?email={email}&token={token}&newPassword={newPassword}",
                new { });

            if (response.IsSuccessStatusCode)
            {
                message = "✅ Password reset successfully! You can now log in.";
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                message = $"❌ Failed: {error}";
            }
        }
        catch (Exception ex)
        {
            message = $"❌ Error: {ex.Message}";
        }
    }
}
